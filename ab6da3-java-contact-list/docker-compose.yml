services:
  evaluation:
    build: .
    volumes:
      - ./evaluation/reports:/app/evaluation/reports
    command: python evaluation/evaluation.py

  test-before:
    build: .
    environment:
      - TEST_REPO_PATH=/app/repository_before
    # CI runs this as a separate command and expects a 0 exit code.
    # We still print failures, but do not fail the container exit status.
    command: sh -c "pytest -q tests || true"

  test-after:
    build: .
    environment:
      - TEST_REPO_PATH=/app/repository_after
    command: pytest -q tests
